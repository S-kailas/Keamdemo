<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KEAM Exam</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f8fafc; }
    .container { display: flex; }
    .main { flex: 1; padding: 1rem; }
    .question-box { background: white; padding: 1rem; border-radius: 1rem; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 1rem; }
    .options { display: flex; flex-direction: column; gap: 0.5rem; }
    .controls { display: flex; gap: 1rem; margin-top: 1rem; }
    .palette { display: grid; grid-template-columns: repeat(auto-fill, 40px); gap: 5px; max-width: 300px; margin-top: 1rem; }
    .palette button { width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ccc; cursor: pointer; background: white; }
    .legend { margin-top: 1rem; font-size: 0.9rem; }
    .green { background: green; color: white; }
    .red { background: red; color: white; }
    .yellow { background: yellow; color: black; }
    .blue { background: blue; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <div class="main">
      <div class="question-box">
        <div id="question-text"></div>
        <div class="options" id="options"></div>
      </div>
      <div class="controls">
        <button onclick="saveAndPrev()">Save & Previous</button>
        <button onclick="saveAndNext()">Save & Next</button>
        <button onclick="clearResponse()">Clear Response</button>
        <button onclick="toggleMarkForReview()">Mark/Unmark for Review</button>
      </div>
      <div class="palette" id="palette"></div>
      <div class="legend">
        <p><span class="green">⬤</span> Answered</p>
        <p><span class="red">⬤</span> Not Answered</p>
        <p><span class="blue">⬤</span> Marked with Answer</p>
        <p><span class="yellow">⬤</span> Marked without Answer</p>
      </div>
    </div>
  </div>
  <div id="result-modal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:#000000aa; display:flex; justify-content:center; align-items:center;">
    <div id="result-box" style="background:white; padding:2rem; border-radius:1rem; width:300px; text-align:center;">
      <button onclick="closeResult()">Close</button>
    </div>
  </div>
<script>
const questions = [
  { id: 1, subject: 'physics', text: 'F = ma is?', options: { a: 'Newton 1', b: 'Newton 2', c: 'Newton 3' }, answer: 'b' },
  { id: 2, subject: 'physics', text: 'Speed of light?', options: { a: '3x10^8', b: '5x10^6', c: 'None' }, answer: 'a' },
  { id: 3, subject: 'chemistry', text: 'H2O is?', options: { a: 'Acid', b: 'Base', c: 'Water' }, answer: 'c' },
];

let currentIndex = 0;
const answers = Array(questions.length).fill(null);
const marked = Array(questions.length).fill(false);
const paletteStatus = Array(questions.length).fill("white");
let timer = 60 * 60; // 1 hour
let submitted = false;

function updateQuestion() {
  const q = questions[currentIndex];
  document.getElementById("question-text").innerText = q.text;

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = '';
  for (const [key, val] of Object.entries(q.options)) {
    const btn = document.createElement("button");
    btn.textContent = `${key}: ${val}`;
    btn.onclick = () => selectOption(key);
    if (answers[currentIndex] === key) btn.style.background = "#cce5ff";
    optionsDiv.appendChild(btn);
  }
}

function updatePalette() {
  const palette = document.getElementById("palette");
  palette.innerHTML = '';
  for (let i = 0; i < questions.length; i++) {
    const btn = document.createElement("button");
    let status = paletteStatus[i];
    if (status === "answered") btn.className = "green";
    else if (status === "unanswered") btn.className = "red";
    else if (status === "marked-answered") btn.className = "blue";
    else if (status === "marked-unanswered") btn.className = "yellow";
    btn.textContent = i + 1;
    btn.onclick = () => { saveStatus(currentIndex); currentIndex = i; updateQuestion(); };
    palette.appendChild(btn);
  }
}

function saveStatus(index) {
  if (marked[index]) {
    paletteStatus[index] = answers[index] ? "marked-answered" : "marked-unanswered";
  } else {
    paletteStatus[index] = answers[index] ? "answered" : "unanswered";
  }
}

function saveAndNext() {
  saveStatus(currentIndex);
  if (currentIndex < questions.length - 1) currentIndex++;
  updateQuestion();
  updatePalette();
}

function saveAndPrev() {
  saveStatus(currentIndex);
  if (currentIndex > 0) currentIndex--;
  updateQuestion();
  updatePalette();
}

function selectOption(opt) {
  answers[currentIndex] = opt;
  saveStatus(currentIndex);
  updateQuestion();
  updatePalette();
}

function clearResponse() {
  answers[currentIndex] = null;
  saveStatus(currentIndex);
  updateQuestion();
  updatePalette();
}

function toggleMarkForReview() {
  marked[currentIndex] = !marked[currentIndex];
  saveStatus(currentIndex);
  if (currentIndex < questions.length - 1) currentIndex++;
  updateQuestion();
  updatePalette();
}

function updateTimer() {
  // not shown in UI, implement if needed
}

function showResult() {
  let totalMarks = 0;
  let correct = 0, wrong = 0, notAnswered = 0;

  for (let i = 0; i < questions.length; i++) {
    const q = questions[i];
    const userAns = answers[i];
    const status = paletteStatus[i];

    if (status === "answered" || status === "marked-answered") {
      if (userAns === q.answer) {
        totalMarks += 4;
        correct++;
      } else {
        totalMarks -= 1;
        wrong++;
      }
    } else {
      notAnswered++;
    }
  }

  const resultBox = document.getElementById("result-box");
  resultBox.innerHTML = `
    <h2>Exam Result</h2>
    <p><strong>Total Marks:</strong> ${totalMarks}</p>
    <p><strong>Correct Answers:</strong> ${correct} × 4 = ${correct * 4}</p>
    <p><strong>Wrong Answers:</strong> ${wrong} × -1 = ${-wrong}</p>
    <p><strong>Unanswered:</strong> ${notAnswered} × 0 = 0</p>
    <button onclick="closeResult()">Close</button>
  `;
  document.getElementById("result-modal").style.display = "block";
}

function closeResult() {
  document.getElementById("result-modal").style.display = "none";
}

setInterval(() => {
  if (!submitted && timer > 0) {
    timer--;
    if (timer === 0) {
      saveStatus(currentIndex);
      updatePalette();
      alert("Time is up! Submitting your answers.");
      showResult();
      submitted = true;
    }
  }
}, 1000);

updateQuestion();
updatePalette();
</script>
</body>
</html>

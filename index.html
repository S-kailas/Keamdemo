<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Exam UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f8fafc; }
    .container { display: flex; min-height: 100vh; }
    .main { flex: 1; padding: 40px 24px 24px 48px; }
    .question-box {
      background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001;
      padding: 32px; max-width: 700px;
    }
    .question-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; }
    .question-text { font-size: 17px; margin-bottom: 24px; color: #b91c1c; }
    .option-label {
      display: block; padding: 10px 0 10px 8px; border-radius: 4px; margin-bottom: 4px;
      cursor: pointer; font-size: 16px;
    }
    .option-label.selected { background: #e0f7fa; }
    .nav-btn, .clear-btn, .mark-btn, .submit-btn {
      border: none; border-radius: 5px; font-size: 15px; font-weight: 500; padding: 10px 18px; margin-right: 10px;
      cursor: pointer;
    }
    .nav-btn { background: #2563eb; color: #fff; }
    .nav-btn:disabled { background: #a5b4fc; cursor: not-allowed; }
    .clear-btn { background: #ef4444; color: #fff; }
    .mark-btn { background: #facc15; color: #222; }
    .submit-btn { background: #22c55e; color: #fff; }
    .sidebar {
      width: 320px; background: #f1f5f9; padding: 32px 16px 16px 16px;
      border-left: 1px solid #e5e7eb; display: flex; flex-direction: column; align-items: flex-start;
    }
    .timer { align-self: flex-end; font-size: 18px; font-weight: 600; margin-bottom: 24px; }
    .palette-section { margin-bottom: 16px; }
    .palette-title { font-weight: bold; margin-bottom: 4px; }
    .palette { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px; }
    .palette-btn {
      width: 28px; height: 28px; border-radius: 4px; border: 1px solid #ccc;
      font-size: 15px; background: #fff; cursor: pointer; transition: 0.2s;
    }
    .palette-btn.current { border: 2px solid #007bff; font-weight: bold; }
    .palette-btn.answered { background: #bbf7d0 !important; }
    .palette-btn.unanswered { background: #fff !important; }
    .palette-btn.marked { background: #fde68a !important; }
    .palette-btn.answered-marked { background: #a5b4fc !important; }
    .legend { margin-top: 32px; }
    .legend-title { font-weight: 600; margin-bottom: 8px; }
    .legend-row { display: flex; align-items: center; margin-bottom: 4px; }
    .legend-box {
      display: inline-block; width: 18px; height: 18px; margin-right: 8px; border-radius: 4px; border: 1px solid #ccc;
    }
    .legend-answered { background: #bbf7d0; }
    .legend-unanswered { background: #fff; }
    .legend-marked { background: #fde68a; }
    .legend-answered-marked { background: #a5b4fc; }
    .result-modal {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; z-index: 1000;
    }
    .result-content {
      background: #fff; padding: 32px; border-radius: 8px; box-shadow: 0 2px 8px #0002; min-width: 320px;
      text-align: center;
    }
    .result-content h2 { margin-top: 0; }
    .close-btn {
      margin-top: 24px; background: #2563eb; color: #fff; border: none; border-radius: 5px; padding: 10px 24px; font-size: 16px; cursor: pointer;
    }
    @media (max-width: 900px) {
      .container { flex-direction: column; }
      .sidebar { width: 100%; border-left: none; border-top: 1px solid #e5e7eb; flex-direction: row; flex-wrap: wrap; }
      .main { padding: 16px; }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="main">
    <div class="question-box" id="question-box">
      <div class="question-title" id="question-number"></div>
      <div class="question-text" id="question-text"></div>
      <div id="options"></div>
      <div style="display: flex; gap: 12px; margin-top: 32px;">
        <button class="nav-btn" id="next-btn">Save & Next &gt;</button>
        <button class="clear-btn" id="clear-btn">Clear Response</button>
        <button class="mark-btn" id="mark-btn">Mark/Unmark for review</button>
        <button class="submit-btn" id="submit-btn" style="display:none;">Submit</button>
      </div>
    </div>
  </div>
  <div class="sidebar">
    <div class="timer" id="timer"></div>
    <div class="palette-section" id="palette-physics"></div>
    <div class="palette-section" id="palette-chemistry"></div>
    <div class="palette-section" id="palette-maths"></div>
    <div style="margin-top: 16px; font-size: 15px;">
      <div><b>Physics</b>: <span id="answered-physics">0</span> Answered</div>
      <div><b>Chemistry</b>: <span id="answered-chemistry">0</span> Answered</div>
      <div><b>Maths</b>: <span id="answered-maths">0</span> Answered</div>
    </div>
    <div class="legend">
      <div class="legend-title">Legend</div>
      <div class="legend-row"><span class="legend-box legend-answered"></span> Answered</div>
      <div class="legend-row"><span class="legend-box legend-unanswered"></span> Not Answered</div>
      <div class="legend-row"><span class="legend-box legend-marked"></span> Marked for review</div>
      <div class="legend-row"><span class="legend-box legend-answered-marked"></span> Answered & marked for review</div>
    </div>
  </div>
</div>
<!-- Result Modal -->
<div id="result-modal" class="result-modal" style="display:none;">
  <div class="result-content" id="result-content"></div>
</div>
<script>
  // --- CONFIGURATION ---
  const subjects = [
    { name: "Physics", count: 3 }, // For demo, use 3. Change to 45 for real.
    { name: "Chemistry", count: 2 }, // For demo, use 2. Change to 30 for real.
    { name: "Maths", count: 2 } // For demo, use 2. Change to 75 for real.
  ];

  // --- QUESTIONS DATA ---
  // Fill your own questions, options, and correct answer index (0-based)
  const questions = [
    // Physics
    { subject: "Physics", question: "What is 2+2?", options: ["3", "4", "5", "6", "7"], answer: 1 },
    { subject: "Physics", question: "What is the SI unit of force?", options: ["Joule", "Newton", "Watt", "Pascal", "Volt"], answer: 1 },
    { subject: "Physics", question: "Speed of light is?", options: ["3x10^8 m/s", "3x10^6 m/s", "3x10^5 m/s", "3x10^7 m/s", "3x10^9 m/s"], answer: 0 },
    // Chemistry
    { subject: "Chemistry", question: "Water formula?", options: ["CO2", "H2O", "O2", "NaCl", "HCl"], answer: 1 },
    { subject: "Chemistry", question: "Atomic number of Oxygen?", options: ["6", "7", "8", "9", "10"], answer: 2 },
    // Maths
    { subject: "Maths", question: "What is 5x5?", options: ["10", "15", "20", "25", "30"], answer: 3 },
    { subject: "Maths", question: "Square root of 16?", options: ["2", "4", "6", "8", "10"], answer: 1 }
  ];

  // --- STATE ---
  let currentIndex = 0;
  let answers = Array(questions.length).fill(null);
  let marked = Array(questions.length).fill(false);
  let timer = 60 * 60; // 1 hour in seconds
  let submitted = false;

  // --- HELPERS ---
  function getSubjectStartIndex(subject) {
    let idx = 0;
    for (let s of subjects) {
      if (s.name === subject) break;
      idx += s.count;
    }
    return idx;
  }

  function updateQuestion() {
    if (submitted) {
      document.getElementById("question-box").style.display = "none";
      return;
    }
    const q = questions[currentIndex];
    document.getElementById("question-number").textContent = "Question no. " + (currentIndex + 1);
    document.getElementById("question-text").innerHTML = `Q. <span style="color:#222">${q.question || '<span style="color:#aaa">[Type your question here]</span>'}</span>`;
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";
    q.options.forEach((opt, i) => {
      const label = document.createElement("label");
      label.className = "option-label" + (answers[currentIndex] === i ? " selected" : "");
      label.innerHTML = `<input type="radio" name="option" ${answers[currentIndex] === i ? "checked" : ""} style="margin-right:12px;"> <b>${String.fromCharCode(65 + i)}.</b> ${opt || '<span style="color:#aaa">[Option]</span>'}`;
      label.onclick = () => { answers[currentIndex] = i; updateQuestion(); updatePalette(); updateAnsweredCount(); };
      optionsDiv.appendChild(label);
    });
    document.getElementById("next-btn").style.display = (currentIndex === questions.length - 1) ? "none" : "";
    document.getElementById("submit-btn").style.display = (currentIndex === questions.length - 1) ? "" : "none";
    document.getElementById("mark-btn").textContent = marked[currentIndex] ? "Unmark for review" : "Mark for review";
  }

  function updatePalette() {
    let idx = 0;
    subjects.forEach(subj => {
      const paletteDiv = document.getElementById("palette-" + subj.name.toLowerCase());
      paletteDiv.innerHTML = `<div class="palette-title">${subj.name}</div><div class="palette" id="palette-${subj.name.toLowerCase()}-btns"></div>`;
      const btnsDiv = document.getElementById(`palette-${subj.name.toLowerCase()}-btns`);
      for (let i = 0; i < subj.count; i++, idx++) {
        let btn = document.createElement("button");
        btn.className = "palette-btn";
        if (answers[idx] !== null && marked[idx]) btn.classList.add("answered-marked");
        else if (answers[idx] !== null) btn.classList.add("answered");
        else if (marked[idx]) btn.classList.add("marked");
        else btn.classList.add("unanswered");
        if (idx === currentIndex) btn.classList.add("current");
        btn.textContent = i + 1;
        btn.onclick = () => { currentIndex = idx; updateQuestion(); updatePalette(); };
        btnsDiv.appendChild(btn);
      }
    });
  }

  function updateAnsweredCount() {
    subjects.forEach(subj => {
      const start = getSubjectStartIndex(subj.name);
      const count = answers.slice(start, start + subj.count).filter(a => a !== null).length;
      document.getElementById("answered-" + subj.name.toLowerCase()).textContent = count;
    });
  }

  function updateTimer() {
    const min = String(Math.floor(timer / 60)).padStart(2, "0");
    const sec = String(timer % 60).padStart(2, "0");
    document.getElementById("timer").textContent = `${min}:${sec}`;
  }

  function showResult() {
    submitted = true;
    document.getElementById("question-box").style.display = "none";
    document.getElementById("result-modal").style.display = "flex";
    // Calculate stats
    let total = questions.length;
    let correct = 0, incorrect = 0, unanswered = 0;
    answers.forEach((ans, i) => {
      if (ans === null) unanswered++;
      else if (ans === questions[i].answer) correct++;
      else incorrect++;
    });
    // Per subject
    let subjectStats = subjects.map(subj => {
      const start = getSubjectStartIndex(subj.name);
      const end = start + subj.count;
      const ans = answers.slice(start, end);
      const q = questions.slice(start, end);
      let c = 0, ic = 0, ua = 0;
      ans.forEach((a, i) => {
        if (a === null) ua++;
        else if (a === q[i].answer) c++;
        else ic++;
      });
      return {
        name: subj.name,
        correct: c,
        incorrect: ic,
        unanswered: ua
      };
    });
    // Show result
    document.getElementById("result-content").innerHTML = `
      <h2>Result</h2>
      <p><b>Total Questions:</b> ${total}</p>
      <p><b>Correct:</b> ${correct}</p>
      <p><b>Incorrect:</b> ${incorrect}</p>
      <p><b>Unanswered:</b> ${unanswered}</p>
      <hr>
      <b>Per Subject:</b>
      <ul style="text-align:left;">
        ${subjectStats.map(s => `<li>${s.name}: ${s.correct} correct, ${s.incorrect} incorrect, ${s.unanswered} unanswered</li>`).join("")}
      </ul>
      <button class="close-btn" onclick="closeResult()">Close</button>
    `;
  }

  function closeResult() {
    document.getElementById("result-modal").style.display = "none";
    // Optionally, reload or redirect here
    // location.reload();
  }

  // --- EVENT LISTENERS ---
  document.getElementById("next-btn").onclick = () => {
    if (currentIndex < questions.length - 1) currentIndex++;
    updateQuestion(); updatePalette();
  };
  document.getElementById("clear-btn").onclick = () => {
    answers[currentIndex] = null;
    updateQuestion(); updatePalette(); updateAnsweredCount();
  };
  document.getElementById("mark-btn").onclick = () => {
    marked[currentIndex] = !marked[currentIndex];
    updateQuestion(); updatePalette();
  };
  document.getElementById("submit-btn").onclick = () => {
    if (confirm("Are you sure you want to submit?")) {
      showResult();
    }
  };

  // --- INIT ---
  updateQuestion();
  updatePalette();
  updateAnsweredCount();
  updateTimer();
  setInterval(() => {
    if (!submitted && timer > 0) {
      timer--;
      updateTimer();
      if (timer === 0) {
        alert("Time is up! Submitting your answers.");
        showResult();
      }
    }
  }, 1000);

  // Expose closeResult for modal button
  window.closeResult = closeResult;
</script>
</body>
</html>
